# Transfer files

Submarine provides an unique feature for file transfering (this is a main update on v1.x from v0.9x). It supports copying file in two directions. One of them is local-to-remote, the other is remote-to-remote via local.


```
const Submarine=require('Submarine');

const TransferFiles=class extends Submarine {
  fetch(){
    return [{
      a: `${__dirname}/files/a.txt`,
    }, {
      conn: 'ssh',
      host: 'server2',
      files: {
        b: `${__dirname}/files/b.txt`,
        c: `${__dirname}/files/dir`,
      },
   }];
  }

  query(files1, files2){
    return {
      a: String.raw`
        cat ${files1.a}
      `,

      b: String.raw`
        cat ${files2.b}
      `,

      c: String.raw`
        cat ${files2.c}/c.txt
      `,

      fileA: String.raw`,
        echo ${files1.a}
      `,

      fileB: String.raw`
        echo ${files2.b}
      `,

      fileC: String.raw`
        echo ${files2.c}/c.txt
      `,
    };
  }

  test(stats, files1, files2){
    return {
      a: stats.a === 'a', // true
      b: stats.b === 'b', // true
      c: stats.c === 'c', // true
    };
  }

  batch(tests, files1, files2){
    return String.raw`
      cat ${files1.a} ${files2.b} ${files2.c}/c.txt
    `;
  }

}


const transfer=new TransferFiles({
  conn: 'ssh',
  host: 'server1',
});
    

Promise.all([
  transfer.current(),
  transfer.call(),
]).then(console.log).finally(
  none => transfer.close()
);
```



Here in `fetch` interface newly appears. This must be implemented returning one object or array of objects. And all these objects must be in two types of formats:

1. key-filepath sets
```
{
  a: 'fileA',
  b: 'fileB',
}
```
2. connector option with `files` parameter whose value is format 1
```
{
  conn: 'ssh',
  host: 'serverX',
  files: {
    a: 'fileA',
    b: 'fileB',
  },
}
```

Format 1 is interpretted as local-to-remote transfering (filepaths on localhost is copyied to the target server), and format 2 is done as remote-to-remote one (filepaths on 'serverX' is transferred to the target server via localhost).

And all files are first transferred to temporary dir(`/tmp/submarine-<uuid>` is hard-coded) on the target server, then you can use these destination paths through the arguments of `query`, `test` and `command` functions. For `query`, these are passed as the first to last arguments, for `test` and `command`, done as the second to last aruguments.

So `new TransferFiles` in the sample consequently does transfering localhost's a.txt and server2's b.txt and "dir" directory to the target's `/tmp` dir.
