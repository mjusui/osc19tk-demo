const Submarine=require('Submarine');

const Step1=class extends Submarine {
  filepath(){
    return '/tmp/submarine/step1.txt';
  }
  query(){
    return {
      step: String.raw`
        test -r \
          ${this.filepath()} \
        && cat ${this.filepath()} \
        || echo ''
      `,
    };
  }

  test(stats){
    return {
      finished: !(stats.step === ''),
    };
  }

  command(){
    return String.raw`
      mkdir -p \
        $(dirname ${this.filepath()}) \
      && touch \
        ${this.filepath()} \
      && uuidgen -r \
        > ${this.filepath()}
    `;
  }
}


const Step2=class extends Step1 {
  filepath(){
    return '/tmp/submarine/step2.txt';
  }

  command(){
    return String.raw`
      cat \
        /tmp/submarine/step1.txt \
      > ${this.filepath()}
    `;
  }
}


const Steps=Submarine.chain(
  Step1,
  Step2
);

const steps=new Steps({
  conn: 'ssh',
  host: 'server1',
});


steps.correct()
  .then(console.log);

